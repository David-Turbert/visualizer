<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title></title>

    <script type="text/javascript" language="javascript" src="./lib/JSmol.min.js"></script>


</head>
<body style="margin: 0; padding: 0; overflow: hidden;">

<div id="appletContainer"></div>

<script type="text/javascript">

    var jsmolApplet;
    var deferred = $.Deferred();
    var self = window;

    window.setController = function (controller) {
        this.controller = controller;
    };

    window.setInDom = function () {
        var useSignedApplet = false, self = this;
        var info = {
            width: window.innerWidth,
            height: window.innerHeight,
            debug: false,
            color: "0xF0F0F0",
            addSelectionOptions: false,
            use: "HTML5",
            j2sPath: "./lib/j2s",
            isSigned: useSignedApplet,
            disableJ2SLoadMonitor: true,
            disableInitialConsole: true,

            readyFunction: function (applet) {
                deferred.done(function () {
                    self.view.resolveReady();
                });
            },
            allowjavascript: true,
            script: "set antialiasDisplay"
        };

     //   Jmol._XhtmlElement = $('#appletContainer').get(0);
     //   Jmol._XhtmlAppendChild = true;
        window.applet=Jmol.getApplet("appletContainer", info);
    };

    window.setView = function (view) {
        this.view = view;
        deferred.resolve();
    };

    window.executeScript = function (actions) {
        if (window.applet) {
            Jmol.script(window.applet, actions.join('\r\n'));
        }
    };

    window.setMolFile = function (data) {
        if (!data) return;

        data = data.get();

        var actions = [];
        actions.push("load data 'model'");
        actions.push(data);
        actions.push("end 'model';");
        this.executeScript(actions);
    };

    window.setSize = function (w, h) {
        Jmol.resizeApplet(this.applet, [w , h ]);
    };

    window.clear = function () {
        this.applet.reset();
    };

    // TODO !!!!
    window.setHighlight = function (atoms, onOff) {
        var molIndex = 1;
        if (!onOff) {
            jsmeApplet.resetAtomColors(1);
        } else {
            var highlight = [];
            for (var i = 0; i < atoms.length; i++) {
                highlight.push(atoms[i] + 1);
                highlight.push(3);
            }
            jsmeApplet.setAtomBackgroundColors(molIndex, highlight.join(","))
        }
    };

    // TODO !!!!
    window.clearHighlight = function (molIndex, atomsIndex) {
        jsmeApplet.resetAtomColors(molIndex);
    };

   window.setInDom();

</script>
</body>
</html>