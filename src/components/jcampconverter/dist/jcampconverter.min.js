// jcampconverter@v2.0.4, MIT licensed. https://github.com/cheminfo/jcampconverter
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JcampConverter=e()}}(function(){return function e(t,r,a){function i(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var p=r[s]={exports:{}};t[s][0].call(p.exports,function(e){var r=t[s][1][e];return i(r?r:e)},p,p.exports,e,t,r,a)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(e,t){"use strict";function r(){function e(e){for(var t=e.length,r=new Array(t),a=0;t>a;a++)r[a]=parseFloat(e[a]);return r}function t(t,l){l=l||{};var p,u,c,g,d,h,F,m,v,X=new Date,y={},x={};x.profiling=[],x.logs=[];var A=[];x.spectra=A,x.info={};var T={};if("string"!=typeof t)return x;for(x.profiling&&x.profiling.push({action:"Before split to LDRS",time:new Date-X}),g=t.split(/[\r\n]+##/),x.profiling&&x.profiling.push({action:"Split to LDRS",time:new Date-X}),g[0]&&(g[0]=g[0].replace(/^[\r\n ]*##/,"")),d=0,h=g.length;h>d;d++){if(p=g[d],F=p.indexOf("="),F>0?(u=p.substring(0,F),c=p.substring(F+1).trim()):(u=p,c=""),u=u.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"==u&&(m=c.indexOf("\n"),-1==m&&(m=c.indexOf("\r")),m>0)){var b=-1,O=-1;if(v=c.substring(0,m).split(/[ ,;\t]+/),v[0].indexOf("++")>0){var C=v[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),E=v[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");b=y.symbol.indexOf(C),O=y.symbol.indexOf(E)}-1==b&&(b=0),-1==O&&(O=0),y.first&&(y.first.length>b&&(T.firstX=y.first[b]),y.first.length>O&&(T.firstY=y.first[O])),y.last&&(y.last.length>b&&(T.lastX=y.last[b]),y.last.length>O&&(T.lastY=y.last[O])),y.vardim&&y.vardim.length>b&&(T.nbPoints=y.vardim[b]),y.factor&&(y.factor.length>b&&(T.xFactor=y.factor[b]),y.factor.length>O&&(T.yFactor=y.factor[O])),y.units&&(y.units.length>b&&(T.xUnit=y.units[b]),y.units.length>O&&(T.yUnit=y.units[O])),T.datatable=v[0],v[1]&&v[1].indexOf("PEAKS")>-1?u="PEAKTABLE":v[1]&&(v[1].indexOf("XYDATA")||v[0].indexOf("++")>0)&&(u="XYDATA",T.deltaX=(T.lastX-T.firstX)/(T.nbPoints-1))}if("TITLE"==u)T.title=c;else if("DATATYPE"==u)T.dataType=c,c.indexOf("nD")>-1&&(x.twoD=!0);else if("XUNITS"==u)T.xUnit=c;else if("YUNITS"==u)T.yUnit=c;else if("FIRSTX"==u)T.firstX=parseFloat(c);else if("LASTX"==u)T.lastX=parseFloat(c);else if("FIRSTY"==u)T.firstY=parseFloat(c);else if("NPOINTS"==u)T.nbPoints=parseFloat(c);else if("XFACTOR"==u)T.xFactor=parseFloat(c);else if("YFACTOR"==u)T.yFactor=parseFloat(c);else if("DELTAX"==u)T.deltaX=parseFloat(c);else if(".OBSERVEFREQUENCY"==u||"$SFO1"==u)T.observeFrequency||(T.observeFrequency=parseFloat(c));else if(".OBSERVENUCLEUS"==u)T.xType||(x.xType=c.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"==u)x.indirectFrequency||(x.indirectFrequency=parseFloat(c));else if("$OFFSET"==u)x.shiftOffsetNum=0,x.shiftOffsetVal||(x.shiftOffsetVal=parseFloat(c));else if("$REFERENCEPOINT"==u);else if("VARNAME"==u)y.varname=c.split(/[, \t]+/);else if("SYMBOL"==u)y.symbol=c.split(/[, \t]+/);else if("VARTYPE"==u)y.vartype=c.split(/[, \t]+/);else if("VARFORM"==u)y.varform=c.split(/[, \t]+/);else if("VARDIM"==u)y.vardim=e(c.split(/[, \t]+/));else if("UNITS"==u)y.units=c.split(/[, \t]+/);else if("FACTOR"==u)y.factor=e(c.split(/[, \t]+/));else if("FIRST"==u)y.first=e(c.split(/[, \t]+/));else if("LAST"==u)y.last=e(c.split(/[, \t]+/));else if("MIN"==u)y.min=e(c.split(/[, \t]+/));else if("MAX"==u)y.max=e(c.split(/[, \t]+/));else if(".NUCLEUS"==u)x.twoD&&(x.yType=c.split(/[, \t]+/)[0]);else if("PAGE"==u){T.page=c.trim(),T.pageValue=parseFloat(c.replace(/^.*=/,"")),T.pageSymbol=T.page.replace(/=.*/,"");var S=y.symbol.indexOf(T.pageSymbol),R="";y.units&&y.units[S]&&(R=y.units[S]),x.indirectFrequency&&"PPM"!=R&&(T.pageValue/=x.indirectFrequency)}else"RETENTIONTIME"==u?T.pageValue=parseFloat(c):"XYDATA"==u?(n(x,T),c.match(/.*\+\+.*/)?o(T,c,x):s(T,c,x),A.push(T),T={}):"PEAKTABLE"==u?(n(x,T),s(T,c,x),A.push(T),T={}):a(u)?T[r(u)]=c:u.match(/^[A-Z].*/)&&(x.info[u]=c.trim())}return x.profiling&&x.profiling.push({action:"Finished parsing",time:new Date-X}),x.twoD&&(f(x),x.profiling&&x.profiling.push({action:"Finished countour plot calculation",time:new Date-X}),l.keepSpectra||delete x.spectra),A.length>1&&A[0].dataType.toLowerCase().match(/.*mass./)&&(i(x),x.profiling&&x.profiling.push({action:"Finished GCMS calculation",time:new Date-X})),x.profiling&&x.profiling.push({action:"Total time",time:new Date-X}),x}function r(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function a(e){for(var t=0;t<h.length;t++)if(e==h[t])return!0;return!1}function i(e){var t,a=e.spectra,i=[];for(t=0;t<h.length;t++){var n=r(h[t]);a[0][n]&&i.push(n)}var s={};for(s.gc={},s.ms=[],t=0;t<i.length;t++)s.gc[i[t]]=[];for(t=0;t<a.length;t++){for(var o=a[t],l=0;l<i.length;l++)s.gc[i[l]].push(o.pageValue),s.gc[i[l]].push(parseFloat(o[i[l]]));o.data&&(s.ms[t]=o.data[0])}e.gcms=s}function n(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"==t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var r=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-r,t.lastX=t.lastX-r}}function s(e,t,r){var a,i,n,s,o,l=[];e.data=[l];var f=t.split(/,? *,?[;\r\n]+ */),p=0;for(a=1,i=f.length;i>a;a++)if(o=f[a].trim().replace(c,"").split(g),o.length%2==0)for(n=0,s=o.length;s>n;n+=2)l[p++]=parseFloat(o[n])*e.xFactor,l[p++]=parseFloat(o[n+1])*e.yFactor;else r.logs.push("Format error: "+o)}function o(e,t,r){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1));var a=[];e.data=[a];var i,n,s,o=e.firstX,l=e.firstY,f=t.split(/[\r\n]+/);n=[];for(var p=1,g=f.length;g>p;p++)if(n=f[p].trim().replace(c,"").split(u),n.length>0){if(d){e.firstPoint||(e.firstPoint=parseFloat(n[0]));var h=parseFloat(n[0]-e.firstPoint)*e.xFactor+e.firstX;(i||0==i)&&(h+=e.deltaX),r.logs.push("Checking X value: currentX: "+o+" - expectedCurrentX: "+h)}for(var F=1,m=n.length;m>F;F++)if(1!=F||!i&&0!=i){if(n[F].length>0)if(s=n[F].charCodeAt(0),43==s||45==s||46==s||s>47&&58>s)i=null,l=parseFloat(n[F]),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>63&&74>s)i=null,l=parseFloat(String.fromCharCode(s-16)+n[F].substring(1)),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>96&&106>s)i=null,l=-parseFloat(String.fromCharCode(s-48)+n[F].substring(1)),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>82&&91>s||115==s){var v=parseFloat(String.fromCharCode(s-34)+n[F].substring(1))-1;115==s&&(v=parseFloat("9"+n[F].substring(1))-1);for(var X=0;v>X;X++)i&&(l+=i),a.push(o,l*e.yFactor),o+=e.deltaX}else 37==s?(i=parseFloat("0"+n[F].substring(1)),l+=i,a.push(o,l*e.yFactor),o+=e.deltaX):s>73&&83>s?(i=parseFloat(String.fromCharCode(s-25)+n[F].substring(1)),l+=i,a.push(o,l*e.yFactor),o+=e.deltaX):s>105&&115>s&&(i=-parseFloat(String.fromCharCode(s-57)+n[F].substring(1)),l+=i,a.push(o,l*e.yFactor),o+=e.deltaX)}else i=null,s=n[F].charCodeAt(0)}}function l(e){for(var t=[],r=0,a=e[0].data[0][0],i=e[0].data[0][0],n=e.length,s=e[0].data[0].length/2,o=0;n>o;o++){t[o]=[];for(var l=0;s>l;l++)t[o][l]=e[o].data[0][2*l+1],t[o][l]<a&&(a=e[o].data[0][2*l+1]),t[o][l]>i&&(i=e[o].data[0][2*l+1]),0!=o&&0!=l&&(r+=Math.abs(t[o][l]-t[o][l-1])+Math.abs(t[o][l]-t[o-1][l]))}return{z:t,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[e.length-1].pageValue,minZ:a,maxZ:i,noise:r/((t.length-1)*(t[0].length-1)*2)}}function f(e){var t=l(e.spectra);e.contourLines=p(t),delete t.z,e.minMax=t}function p(e){for(var t,r,a,i,n,s=e.noise,o=e.z,l=[],f=7,p=new Float32Array(4),u=[],c=o.length,g=o[0].length,d=e.minX,h=e.maxX,F=(h-d)/(g-1),m=e.minY,v=e.maxY,X=(v-m)/(c-1),y=e.minZ,x=e.maxZ,A=0;2*f>A;A++){var T={};l.push(T);var b=A%2;n=0==b?(x-5*s)*Math.exp(A/2-f)+5*s:-(x-5*s)*Math.exp(A/2-f)-5*s;var O=[];if(T.zValue=n,T.lines=O,!(y>=n||n>=x))for(var C=0;c-1>C;C++)for(var E=0;g-1>E;E++){p[0]=o[C][E],p[1]=o[C][E+1],p[2]=o[C+1][E],p[3]=o[C+1][E+1];for(var S=0;4>S;S++)u[S]=p[S]>n;u[0]!=u[1]&&u[0]!=u[2]&&(t=E+(n-p[0])/(p[1]-p[0]),r=C,a=E,i=C+(n-p[0])/(p[2]-p[0]),O.push(t*F+d,r*X+m,a*F+d,i*X+m)),u[3]!=u[1]&&u[3]!=u[2]&&(t=E+1,r=C+1-(n-p[3])/(p[1]-p[3]),a=E+1-(n-p[3])/(p[2]-p[3]),i=C+1,O.push(t*F+d,r*X+m,a*F+d,i*X+m)),u[1]!=u[2]&&(t=E+1-(n-p[1])/(p[2]-p[1]),r=C+(n-p[1])/(p[2]-p[1]),u[1]!=u[0]&&(a=E+1-(n-p[1])/(p[0]-p[1]),i=C,O.push(t*F+d,r*X+m,a*F+d,i*X+m)),u[2]!=u[0]&&(a=E,i=C+1-(n-p[2])/(p[0]-p[2]),O.push(t*F+d,r*X+m,a*F+d,i*X+m)),u[1]!=u[3]&&(a=E+1,i=C+(n-p[1])/(p[3]-p[1]),O.push(t*F+d,r*X+m,a*F+d,i*X+m)),u[2]!=u[3]&&(a=E+(n-p[2])/(p[3]-p[2]),i=C+1,O.push(t*F+d,r*X+m,a*F+d,i*X+m)))}}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:l}}var u=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,c=/\$\$.*/,g=/[,\t ]+/,d=!1,h=["TIC",".RIC","SCANNUMBER"];return t}function a(e,t,r){return"boolean"==typeof t&&(r=t,t={}),r?i(e,t):o(e,t)}function i(e,t){return s||n(),new Promise(function(r){var a=Date.now()+""+Math.random();l[a]=r,s.postMessage({stamp:a,input:e,options:t})})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+r.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));s=new Worker(e),URL.revokeObjectURL(e),s.addEventListener("message",function(e){var t=e.data.stamp;l[t]&&l[t](e.data.output)})}var s,o=r(),l={};t.exports={convert:a}},{}]},{},[1])(1)});
//# sourceMappingURL=jcampconverter.min.js.map