{
  "version": "2.9.3",
  "grid": {
    "xWidth": 10,
    "yHeight": 10,
    "layers": {
      "Default layer": {
        "name": "Default layer"
      },
      "Admin": {
        "name": "Admin"
      }
    }
  },
  "modules": [
    {
      "url": "modules/types/client_interaction/dragdrop/",
      "id": 1,
      "title": "SDF file",
      "zindex": 2,
      "configuration": {
        "sections": {},
        "groups": {
          "group": [
            {
              "label": [
                "Drop training SDF"
              ],
              "dragoverlabel": [
                null
              ],
              "hoverlabel": [
                null
              ],
              "getusermedia": [
                []
              ],
              "capture": [
                "none"
              ]
            }
          ],
          "vars": [
            [
              {
                "filter": "ext",
                "extension": "sdf",
                "filetype": "text",
                "type": "string",
                "variable": "sdf"
              }
            ]
          ],
          "string": [
            [
              {
                "type": "string",
                "filter": "text/plain",
                "variable": "sdf"
              }
            ]
          ],
          "photo": [
            [
              {
                "variable": "photo"
              }
            ]
          ]
        }
      },
      "layers": {
        "Default layer": {
          "zIndex": 0,
          "display": true,
          "title": "SDF file",
          "wrapper": true,
          "created": true,
          "name": "Default layer",
          "position": {
            "left": 0,
            "top": 0
          },
          "size": {
            "width": 35,
            "height": 19
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        },
        "Admin": {
          "zIndex": 0,
          "display": true,
          "title": "Untitled",
          "wrapper": true,
          "created": true,
          "name": "Default layer",
          "position": {
            "left": 0,
            "top": 101
          },
          "size": {
            "width": 42,
            "height": 9
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        }
      },
      "vars_out": [
        {
          "event": "onRead",
          "rel": "data",
          "filter": "sdfParser",
          "name": "parserResult",
          "jpath": [
            "sdf",
            "content"
          ]
        }
      ],
      "vars_in": [],
      "actions_in": [
        {}
      ],
      "actions_out": {}
    },
    {
      "url": "modules/types/edition/filter_editor/",
      "id": 2,
      "title": "Schema setter",
      "zindex": 2,
      "configuration": {
        "sections": {},
        "groups": {
          "group": [
            {
              "script": [
                "//When the result is ready, use resolve(result) to send it.\n//In case of an error, use reject(error)\nvar schema = {\n    \"type\": \"object\",\n    \"properties\": {}\n}\n\nvar options = {\n    fields: {}\n}\n\nvar parserResult = value;\n\n// Schema properties based on parsed result\nfor(var i=0; i<parserResult.statistics.length; i++) {\n    if(!parserResult.statistics[i].isNumeric) continue;\n    addToSchema(parserResult.statistics[i].label);\n}\n\nfunction addToSchema(label) {\n    schema.properties[label] = {\n        label: label,\n        type: \"boolean\",\n        default: false\n    }\n    options.fields[label] = {\n        \"rightLabel\": label\n    }\n}\nAPI.createData('alpacaOptions', options);\nresolve(schema);\n"
              ]
            }
          ],
          "libs": [
            [
              {
                "lib": "lodash",
                "alias": "_"
              }
            ]
          ]
        }
      },
      "layers": {
        "Default layer": {
          "zIndex": 0,
          "display": false,
          "title": "",
          "wrapper": true,
          "created": true,
          "name": "Default layer",
          "position": {
            "left": 9,
            "top": 85
          },
          "size": {
            "width": 20,
            "height": 20
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        },
        "Admin": {
          "zIndex": 0,
          "display": true,
          "title": "Schema setter",
          "wrapper": true,
          "created": true,
          "name": "Admin",
          "position": {
            "left": 135,
            "top": 63
          },
          "size": {
            "width": 58,
            "height": 53
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        }
      },
      "vars_in": [
        {
          "rel": "dataobject",
          "name": "parserResult"
        }
      ],
      "actions_in": [
        {}
      ],
      "vars_out": [
        {
          "event": "onButtonClick",
          "rel": "filteredObject",
          "name": "schema",
          "jpath": []
        }
      ],
      "actions_out": {}
    },
    {
      "url": "modules/types/edition/alpaca/",
      "id": 3,
      "title": "Select fields to use",
      "zindex": 2,
      "configuration": {
        "sections": {},
        "groups": {
          "group": [
            {
              "hasButton": [
                []
              ],
              "button_text": [
                "Export"
              ],
              "debouncing": [
                0
              ],
              "sendOnLoad": [
                [
                  "yes"
                ]
              ],
              "output": [
                "new"
              ],
              "mode": [
                "schema"
              ],
              "schemaSource": [
                "variable"
              ],
              "optionsSource": [
                "variable"
              ],
              "schema": [
                "{}"
              ],
              "options": [
                "{}"
              ]
            }
          ]
        }
      },
      "layers": {
        "Default layer": {
          "zIndex": 0,
          "display": true,
          "title": "Select fields to use",
          "wrapper": true,
          "created": true,
          "name": "Default layer",
          "position": {
            "left": 0,
            "top": 40
          },
          "size": {
            "width": 35,
            "height": 55
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        },
        "Admin": {
          "zIndex": 0,
          "display": true,
          "title": "Untitled",
          "wrapper": true,
          "created": true,
          "name": "Admin",
          "position": {
            "left": 93,
            "top": 63
          },
          "size": {
            "width": 40,
            "height": 37
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        }
      },
      "vars_in": [
        {
          "rel": "schema",
          "name": "schema"
        },
        {
          "rel": "options",
          "name": "alpacaOptions"
        }
      ],
      "actions_in": {},
      "vars_out": [
        {
          "event": "onFormSubmit",
          "rel": "outputValue",
          "name": "selection",
          "jpath": []
        }
      ],
      "actions_out": [
        {
          "jpath": []
        }
      ]
    },
    {
      "url": "modules/types/client_interaction/dragdrop/",
      "id": 4,
      "title": "SDF file",
      "zindex": 1,
      "configuration": {
        "sections": {},
        "groups": {
          "group": [
            {
              "label": [
                "Drop new SDF"
              ],
              "dragoverlabel": [
                null
              ],
              "hoverlabel": [
                null
              ],
              "getusermedia": [
                []
              ],
              "capture": [
                "none"
              ]
            }
          ],
          "vars": [
            [
              {
                "filter": "ext",
                "extension": "sdf",
                "filetype": "text",
                "type": "string",
                "variable": "sdf"
              }
            ]
          ],
          "string": [
            [
              {
                "type": "string",
                "filter": "text/plain",
                "variable": "sdf"
              }
            ]
          ],
          "photo": [
            [
              {
                "variable": "photo"
              }
            ]
          ]
        }
      },
      "layers": {
        "Default layer": {
          "zIndex": 0,
          "display": true,
          "title": "SDF file",
          "wrapper": true,
          "created": true,
          "name": "Default layer",
          "position": {
            "left": 0,
            "top": 20
          },
          "size": {
            "width": 35,
            "height": 19
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        },
        "Admin": {
          "zIndex": 0,
          "display": true,
          "title": "Untitled",
          "wrapper": true,
          "created": true,
          "name": "Default layer",
          "position": {
            "left": 0,
            "top": 91
          },
          "size": {
            "width": 42,
            "height": 9
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        }
      },
      "vars_out": [
        {
          "event": "onRead",
          "rel": "data",
          "filter": "sdfParser",
          "name": "parserResult2",
          "jpath": [
            "sdf",
            "content"
          ]
        }
      ],
      "vars_in": [],
      "actions_in": [
        {}
      ],
      "actions_out": {}
    },
    {
      "url": "modules/types/client_interaction/button_action/",
      "id": 5,
      "title": "Untitled",
      "configuration": {
        "sections": {},
        "groups": {
          "group": [
            {
              "label": [
                "Compute Model"
              ],
              "text": [
                ""
              ],
              "toggle": [
                "click"
              ],
              "askConfirm": [
                []
              ],
              "confirmText": [
                "Are you sure?"
              ]
            }
          ]
        }
      },
      "layers": {
        "Default layer": {
          "zIndex": 0,
          "display": true,
          "title": "Untitled",
          "wrapper": true,
          "created": true,
          "name": "Default layer",
          "position": {
            "left": 9,
            "top": 96
          },
          "size": {
            "width": 15,
            "height": 7
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        },
        "Admin": {
          "zIndex": 0,
          "display": true,
          "title": "",
          "wrapper": true,
          "created": true,
          "name": "Admin",
          "position": {
            "left": 0,
            "top": 0
          },
          "size": {
            "width": 20,
            "height": 20
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        }
      },
      "vars_in": [],
      "actions_in": [
        {}
      ],
      "vars_out": {},
      "actions_out": [
        {
          "event": "onClick",
          "rel": "actionText",
          "name": "computeSOM",
          "jpath": []
        }
      ]
    },
    {
      "url": "modules/types/display/single_value/",
      "id": 6,
      "title": "Error",
      "configuration": {
        "sections": {},
        "groups": {
          "group": [
            {
              "defaultvalue": [
                null
              ],
              "font": [
                null
              ],
              "fontcolor": [
                [
                  255,
                  0,
                  0,
                  1
                ]
              ],
              "fontsize": [
                "18pt"
              ],
              "align": [
                "center"
              ],
              "valign": [
                "middle"
              ],
              "sprintf": [
                null
              ],
              "sprintfOrder": [
                null
              ],
              "preformatted": [
                []
              ]
            }
          ]
        }
      },
      "layers": {
        "Default layer": {
          "zIndex": 0,
          "display": true,
          "title": "Error",
          "wrapper": false,
          "created": true,
          "name": "Default layer",
          "position": {
            "left": 36,
            "top": 95
          },
          "size": {
            "width": 113,
            "height": 9
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        },
        "Admin": {
          "zIndex": 0,
          "display": false,
          "title": "",
          "wrapper": true,
          "created": true,
          "name": "Admin",
          "position": {
            "left": 0,
            "top": 0
          },
          "size": {
            "width": 20,
            "height": 20
          },
          "bgColor": [
            255,
            255,
            255,
            0
          ]
        }
      },
      "vars_in": [
        {
          "rel": "value",
          "name": "error"
        }
      ],
      "actions_in": [
        {}
      ],
      "vars_out": {},
      "actions_out": {}
    },
    {
      "url": "modules/types/chart/advanced/som/",
      "configuration": {},
      "layers": {
        "Default layer": {
          "position": {
            "left": 57,
            "top": 13
          },
          "size": {
            "width": 64,
            "height": 44
          },
          "zIndex": 0,
          "display": true,
          "title": "Untitled",
          "bgColor": [
            255,
            255,
            255,
            0
          ],
          "wrapper": true,
          "created": true,
          "name": "Default layer"
        },
        "Admin": {
          "position": {
            "left": 0,
            "top": 0
          },
          "size": {
            "width": 20,
            "height": 20
          },
          "zIndex": 0,
          "display": true,
          "title": "",
          "bgColor": [
            255,
            255,
            255,
            0
          ],
          "wrapper": true,
          "created": true,
          "name": "Admin"
        }
      },
      "id": 7,
      "vars_in": [
        {
          "rel": "model",
          "name": "somModel"
        },
        {
          "rel": "dataset",
          "name": "trainingSet"
        },
        {
          "rel": "dataset",
          "name": "newSet"
        }
      ],
      "actions_in": [
        {}
      ],
      "title": "Untitled",
      "vars_out": [
        {
          "jpath": []
        }
      ],
      "actions_out": {}
    }
  ],
  "variables": [
    {
      "varname": "error",
      "jpath": [
        "error"
      ]
    }
  ],
  "pouchvariables": [
    {}
  ],
  "configuration": {
    "title": "Self-organizing map"
  },
  "actionscripts": [
    {
      "sections": {},
      "groups": {
        "action": [
          {
            "name": [
              "computeSOM"
            ],
            "script": [
              "API.loading('som', 'Computing SOM');\nrequire(['components/ml/dist/ml.min', 'src/util/api', 'lodash', 'components/async/lib/async'], function(ML, API, _, async) {\n    \n    var error = API.getData('error');\n    \n    var training = API.getData('parserResult');\n    if(!training) {\n        return fatal('Please add a training set first');\n    }\n    \n    var selection = API.getData('selection');\n    if(!selection) {\n        return fatal('Please select at least one field');\n    }\n    \n    var selected = Object.keys(selection);\n    if(!selected.length) {\n        return fatal('Please select at least one field');\n    }\n    \n    var stats = training.statistics;\n    var fields = {};\n    for(var i = 0; i < selected.length; i++) {\n        var elem = _.find(stats, function(el) {\n            return el.label === selected[i];\n        });\n        fields[selected[i]] = [elem.minValue, elem.maxValue];\n    }\n    \n    var iterations = 2;\n    \n    var som = new ML.nn.SOM(10,10,{\n        fields: fields,\n        iterations: iterations\n    });\n    \n    som.setTraining(training.molecules);\n    \n    var trainL = training.molecules.length,\n        total = trainL * iterations,\n        step = 0;\n    \n    function trainOne() {\n        if(step%trainL === 0) {\n            API.loading('som', 'Computing SOM ('+(step/trainL)+'/'+iterations+')');\n        }\n        step++;\n        try {\n            return som.trainOne();\n        } catch(e) {\n            return false;\n        }\n    }\n    \n    async.whilst(trainOne, function(cb){\n        setImmediate(cb);\n    }, function () {\n        if((step-1) === total) {\n            API.createData('somModel',som.export());\n            var chart = {\n                x: [],\n                y: [],\n                info: []\n            };\n            var trainingSet = {\n                type: 'chart',\n                value: {\n                    data: [chart]\n                }\n            };\n            var train = som.trainingSet;\n            var predict = som.predict(true);\n            for (var i = 0; i < train.length; i++) {\n                chart.x[i] = predict[i][0] + predict[i][2][0];\n                chart.y[i] = predict[i][1] + predict[i][2][1];\n                chart.info[i] = training.molecules[i]\n            }\n            API.createData('trainingSet', trainingSet);\n            fatal('');\n        } else {\n            fatal('Error during SOM calculation')\n        }\n    });\n    \n    function fatal(msg) {\n        error.setValue(msg);\n        API.stopLoading('som');\n    }\n    \n});"
            ]
          }
        ]
      }
    }
  ],
  "crons": [
    {}
  ],
  "couch_replication": [
    {
      "sections": {},
      "groups": {
        "couch": [
          [
            {
              "direction": "both",
              "continuous": []
            }
          ]
        ]
      }
    }
  ],
  "init_script": [
    {
      "sections": {},
      "groups": {
        "general": [
          {
            "script": [
              "API.createData('error', '');"
            ]
          }
        ]
      }
    }
  ],
  "custom_filters": [
    {
      "sections": {
        "filters": [
          {
            "sections": {},
            "groups": {
              "filter": [
                {
                  "name": [
                    "sdfParser"
                  ],
                  "script": [
                    "return {\n    filter:function filter(value, resolve, reject) {\n        if (value) {\n            resolve(parse(value.get()));\n        }\n    }\n}\n"
                  ]
                }
              ],
              "libs": [
                [
                  {
                    "lib": "components/sdf-parser/dist/sdf-parser",
                    "alias": "parse"
                  }
                ]
              ]
            }
          }
        ]
      },
      "groups": {}
    }
  ],
  "actionfiles": [
    {
      "sections": {},
      "groups": {
        "action": [
          [
            {}
          ]
        ]
      }
    }
  ]
}